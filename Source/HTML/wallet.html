<!DOCTYPE HTML>

<html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TERA</title>
    <link rel="shortcut icon" href="/HTML/PIC/wallet.png" type="image/png">

    <link rel="stylesheet" type="text/css" href="../HTML/CSS/wallet.css">
    <link rel="stylesheet" type="text/css" href="../HTML/CSS/buttons.css">
    <link rel="stylesheet" type="text/css" href="../HTML/CSS/style.css">

</head>



<script>
    window.RUN_CLIENT=1;
    window.RUN_SERVER=0;
    if(typeof global === 'object')
    {
        global.RUN_CLIENT=1;
        global.RUN_SERVER=0;
    }
</script>

<script type="text/javascript" src="../HTML/JS/client.js"></script>
<script type="text/javascript" src="../HTML/JS/sha3.js"></script>
<script type="text/javascript" src="../HTML/JS/crypto-client.js"></script>




<script>
    var CanSendTransaction=1;
    var Net_Work_Mode;
    var MiningAccount=0;
    var min_power_pow_acc_create=0;
    var WalletStatus;
    var BLOCK_PROCESSING_LENGTH=8;
    var PubKeyStr;
    var PrivKeyStr;
    var WalletOpen;
    var MapAccounts={};
    var MapCheckTransaction={};
    var MapSendTransaction={};

    var CurTabName;
    var TabArr=[{name:"TabAccounts",log:1},{name:"TabSend",log:1},{name:"TabHistory"},{name:"TabExplorer"}];
    var SaveIdArr=["idAccount","idTo","idSumTER","idSumCENT","idDescription","idSelStyle",
        "idViewAccountNum","idViewBlockNum","idViewHistoryNum","idViewActNum","idViewHashNum","idWalletPow"];
    var LoadMapAfter={};


    var MapCurrency={};
    MapCurrency[0]="TER";

    var MaxAccID=0;
    var MaxActNum=0;
    var HistoryMaxNum=0;
    var MaxBlockNum=0;


    var CurrentTR={};

</script>

<script>
    /*User action User action User action User action User action User action User action User action User action */

    //CONFIG
    //CONFIG
    //CONFIG
    function IsPrivateMode()
    {
        if(PrivKeyStr && PrivKeyStr.length===64)
            return true;
        else
            return false;
    }

    function MiningSets()
    {
        var name="edit_mining_set";
        if(IsVisibleBlock(name))
        {
            SetVisibleBlock(name,false);
        }
        else
        {
            SetVisibleBlock(name,true);
            document.getElementById("idMiningAccount").value=MiningAccount;
            document.getElementById("idMiningAccount").focus();
        }
    }
    function SaveMiningSet(Value)
    {
        SetVisibleBlock("edit_mining_set",false)

        if(Value)
        {
            MiningAccount=Value;
        }
        else
        {
            MiningAccount=ParseNum(document.getElementById("idMiningAccount").value);
        }
        GetData("/SetMining/"+MiningAccount,function (Data)
        {

        });


    }
    function CancalMiningSet()
    {
        var name="edit_mining_set";
        SetVisibleBlock(name,false)
    }



    function NewPrivateKey()
    {
        var arr = new Uint8Array(32);
        window.crypto.getRandomValues(arr);
        var Str=GetStrFromAddr(arr);

        document.getElementById("idKeyNew").value=Str;
        SetVisibleEditKeys(1);

        var Select=document.getElementById("idTypeKey");
        Select.value="private";
    }
    function EditPrivateKey()
    {
        if(!IsVisibleBlock("edit_keys"))
        {
            var Select=document.getElementById("idTypeKey");
            if(IsPrivateMode())
            {
                document.getElementById("idKeyNew").value=PrivKeyStr;
                Select.value="private";
            }
            else
            {
                document.getElementById("idKeyNew").value=PubKeyStr;
                Select.value="public";
            }



            SetVisibleEditKeys(1);
        }
        else
        {
            CancelSavePrivateKey();
        }
    }

    function SavePrivateKey()
    {
        var Select=document.getElementById("idTypeKey");
        var Str=document.getElementById("idKeyNew").value;
        Str=Str.trim();
        if(Str.length!==64 && Select.value==="private")
        {
            SetStatus("Error: Length must 64 HEX chars. (Length="+Str.length+")");
            return;
        }
        else
        if(Str.length!==66 && Select.value!=="private")
        {
            SetStatus("Error: Length must 66 HEX chars. (Length="+Str.length+")");
            return;
        }

        if(Select.value==="private" && PrivKeyStr!==Str)
            SetStatus("Changed privat key");
        else
        if(Select.value==="public" && PubKeyStr!==Str)
            SetStatus("Changed public key");

        GetData("/SetWalletKey/"+Str, function (Data)
        {
            if(Data && Data.result===1)
            {
                if(Select.value==="private")
                    SelectStyle("styleBlue");
                else
                if(Select.value==="public")
                    SelectStyle("styleGreen");

                SetVisibleEditKeys(0);
                UpdatesData();
            }
        });
    }
    function CancelSavePrivateKey()
    {
        SetVisibleEditKeys(0);
    }

    function SetVisibleEditKeys(bSet)
    {
        SetVisibleBlock("edit_keys",bSet);
        if(bSet)
            document.getElementById("idKeyNew").focus();
    }


    function SetVisibleBlock(name,bSet)
    {

        var Item=document.getElementById(name);
        if(typeof bSet==="string")
            Item.style.display = bSet;
        else
        if(bSet)
        {
            Item.style.display = 'block';
        }
        else
        {
            Item.style.display = 'none';
        }
        return Item;
    }

    function IsVisibleBlock(name)
    {
        var Item=document.getElementById(name);
        if(Item.style.display === 'block' || Item.style.display === "table-row")
            return true;
        else
            return false;

    }

    //ACCOUNTS
    //ACCOUNTS
    //ACCOUNTS
//    function FindMyAccounts()
//    {
//        GetData("/FindMyAccounts",function (Data)
//        {
//           UpdatesData();
//        });
//
//    }

    function NewAccount()
    {
        var name="edit_create_acc";
        if(IsVisibleBlock(name))
        {
            SetVisibleBlock(name,false);
        }
        else
        {
            SetVisibleBlock(name,true);
            document.getElementById("idAccDescription").focus();

            var Select=document.getElementById("idAccount");
            if(Select.options.length)
            {
                document.getElementById("idAutoSetMining").checked=false;
            }

        }
    }
    function CancelCreateAccount()
    {
        var name="edit_create_acc";
        SetVisibleBlock(name,false)
    }

    var WasCreateAccountInfo;
    function CreateAccount()
    {
        if(!CanSendTransaction)
        {
            SetError("Can't Send transaction");
            return;
        }
        var Description=document.getElementById("idAccDescription").value;
        var Adviser=document.getElementById("idAdviser").value;

        WasCreateAccountInfo=PubKeyStr;

        var PubKey=PubKeyStr;
        var TR=
            {
                Type:100,
                Currency:0,
                PubKey:PubKey,
                Description:Description,
                RefID:Adviser,
            };
        var Body=[];
        WriteByte(Body,TR.Type);
        WriteUint(Body,TR.Currency);
        WriteArr(Body,GetArrFromHex(PubKey),33);
        WriteStr(Body,Description,40);
        WriteUint(Body,TR.RefID);
        Body.length+=7;
        Body.length+=12;


        TR.AutoSetMining=document.getElementById("idAutoSetMining").checked;
        SendTransaction(Body,min_power_pow_acc_create,TR);

        CancelCreateAccount();
        document.getElementById("idAccDescription").value="";
    }
    function CheckLengthAccDesription(name,Length)
    {
        var Str=document.getElementById(name).value.substr(0,Length+1);
        var arr=toUTF8Array(Str);
        var Len=Length-arr.length;
        if(Len<0)
            SetError("Bad length");
        else
            SetStatus("Lost: "+Len+" bytes");
    }

    //RECEIVE



    //SEND
    //SEND
    //SEND
    function ClearTransaction()
    {
        var arr=["idAccount","idTo","idSumTER","idSumCENT","idDescription"];
        for(var i=0;i<arr.length;i++)
        {
            var name=arr[i];
            var Item=document.getElementById(name);
            Item.value="";
        }
        SaveValues();
        CreateTransaction();
    }

    function StartEditTransactionJSON()
    {
        var Item=document.getElementById("idTransaction");
        Item.className="bold";
    }

    function EditJSONTransaction()
    {
        var name="edit_transaction";

        var Item=document.getElementById("idTransaction");
        if(IsVisibleBlock(name))
        {
            SetVisibleBlock(name,false)
            Item.className="";
        }
        else
        {
            CreateTransaction();
            SetVisibleBlock(name,true)
            Item.className="";
        }
    }

    function SelectTypeKey()
    {
        var Select=document.getElementById("idTypeKey");
        var Item=document.getElementById("idKeyNew");
        if(Select.value==="public" && Item.value===PrivKeyStr)
            Item.value="";
        else
        if(Select.value==="private" && Item.value===PubKeyStr)
            Item.value="";
    }


    function CurTransactionToForm(bForce)
    {
        var Item=document.getElementById("idTransaction");
        if(Item.className==="" || bForce)
            Item.value=JSON.stringify(CurrentTR,"",4);
    }

    function CheckNameAccTo()
    {
        var ToID = ParseNum(document.getElementById("idTo").value);
        if(!MapAccounts[ToID] || (MapAccounts[ToID].MustUpdate && MapAccounts[ToID].MustUpdate<=MaxBlockNum))
        {
            GetData("/GetAccount/"+ToID,function (Data)
            {
                if(Data && Data.result===1 && Data.Item)
                {
                    Data.Item.UpdateData=(new Date)-0;
                    MapAccounts[Data.Item.Num]=Data.Item;
                    SetNameAccTo();
                }
            });
        }
        SetNameAccTo();
    }

    function SetNameAccTo()
    {
        var Str="";
        var ToID = ParseNum(document.getElementById("idTo").value);
        var element=document.getElementById("idNameTo");
        var Item=MapAccounts[ToID];
        element.innerText="To: "+GetAccountText(Item,ToID);
        if(Item && Item.MyAccount)
            element.className="bold";
        else
            element.className="";
    }

    function OnEditIdTo()
    {
        CheckNameAccTo();
        OnEditTransactionFields();
    }
    function OnEditTransactionFields()
    {
        if(IsVisibleBlock("edit_transaction"))
            CreateTransaction();
    }

    function CreateTransaction(F)
    {
        CheckNameAccTo();
        CheckSending();

        var FromID = ParseNum(document.getElementById("idAccount").value);
        var ToID = ParseNum(document.getElementById("idTo").value);
        var SumTer = ParseNum(document.getElementById("idSumTER").value);
        var SumCent = ParseNum(document.getElementById("idSumCENT").value);
        var Description = document.getElementById("idDescription").value.substr(0,200);


        var OperationID=0;
        var Item=MapAccounts[FromID];
        if(Item)
        {
            OperationID=Item.Value.OperationID;
        }



        var TR=
            {
                Type:110,
                Version:2,
                Currency:0,
                FromID:FromID,
                OperationID:OperationID,
                To:[{ID:ToID,SumTER:SumTer,SumCENT:SumCent}],
                Description:Description,
                Sign:CurrentTR.Sign,

            };



        if(JSON.stringify(TR)===JSON.stringify(CurrentTR))
        {
            if(F)
                F(CurrentTR);
            return;
        }

        CurrentTR=TR;


        GetData("/GetSignTransaction",CurrentTR, function (Data)
        {
            if(Data && Data.result===1)
            {
                CurrentTR.Sign=Data.Sign;
                CurTransactionToForm();
                if(F)
                    F(CurrentTR);
            }
        });

    }

    function CheckSending(bToStatus)
    {
        var CanSend=IsPrivateMode();
        var StrButton="Send";
        var StrButtonSign="Sign JSON";
        if(!CanSend)
        {
            StrButton=" ";
            StrButtonSign=" ";
        }

        if(CanSend)
        {
            var FromID = ParseNum(document.getElementById("idAccount").value);
            var Item=MapAccounts[FromID];
            if(Item && Item.NextSendTime && Item.NextSendTime>MaxBlockNum)
            {
                if(bToStatus)
                    SetStatus("Transaction was sending. Wait... ("+Item.LastTransactionText+")");

                CanSend=false;
                StrButton="Wait...";
            }
        }

        document.getElementById("idSendButton").disabled=(!CanSend);
        document.getElementById("idSendButton").value=StrButton;

        document.getElementById("idSignJSON").disabled=(!CanSend);
        document.getElementById("idSignJSON").value=StrButtonSign;

        return CanSend;
    }
    function SendMoney()
    {
        var ToID = ParseNum(document.getElementById("idTo").value);
        if(ToID<=0)
        {
            SetError("Pay to required!");
            return;
        }
        if(!CanSendTransaction)
        {
            SetError("Can't Send transaction");
            return;
        }


        CheckSending(true);
        if(document.getElementById("idSendButton").disabled)
            return;

        CreateTransaction(SendMoneyTR);
    }

    function GetTransactionFromJSON()
    {
        var Str=document.getElementById("idTransaction").value;
        try
        {
            var TR=JSON.parse(Str);
        }
        catch (e)
        {
            SetStatus(e);
            return undefined;
        }
        return TR;
    }
    function SendMoneyJSON()
    {
        if(!CanSendTransaction)
        {
            SetError("Can't Send transaction");
            return;
        }

        var TR=GetTransactionFromJSON();
        if(!TR)
            return;

        SendMoneyTR(TR);
    }
    function SignJSON(F)
    {
        if(document.getElementById("idSignJSON").disabled)
            return;

        var TR=GetTransactionFromJSON();
        if(!TR)
            return;

        CurrentTR=TR;

        GetData("/GetSignTransaction",CurrentTR, function (Data)
        {
            if(Data && Data.result===1)
            {
                CurrentTR.Sign=Data.Sign;
                CurTransactionToForm(true);
                if(F)
                    F();
            }
        });
    }
    function SignAndSendFromJSON()
    {
        SignJSON(SendMoneyJSON);
    }

    function GetTransactionText(TR,key)
    {
        var Str;
        if(TR)
        {
            if(TR.Type===100)
            {
                Str="New account "+TR.Description.substr(0,20);
            }
            else
            if(TR.Type===110)
            {
                var MapItem={};
                var ValueTotal={SumTER:0,SumCENT:0};

                Str=""+TR.FromID+"/"+TR.OperationID+" to ";
                for(var i=0;i<TR.To.length;i++)
                {
                    var Item=TR.To[i];

                    if(Item.ID===TR.FromID || MapItem[Item.ID])
                        continue;
                    MapItem[Item.ID]=1;

                    ADD(ValueTotal,Item);
                    if(i===0)
                        Str+="[";
                    if(Str.length<16)
                    {
                        if(i>0)
                            Str+=",";
                        Str+=Item.ID;
                    }
                    else
                    if(Str.substr(Str.length-1)!==".")
                        Str+="...";
                }
                Str+="] "+SUM_TO_STRING(ValueTotal,true);
                Str+=" "+TR.Description.substr(0,20);
            }

        }
        else
        {
            if(key)
                Str=key;
            else
                Str="";
        }
        return Str;
    }

    function SendMoneyTR(TR)
    {
        var Body=[];
        WriteByte(Body,TR.Type)
        WriteByte(Body,TR.Version)
        WriteUint(Body,TR.Currency)
        WriteUint(Body,TR.FromID)
        WriteUint32(Body,TR.To.length);
        for(var i=0;i<TR.To.length;i++)
        {
            //To:[{ID:uint,SumTER:uint,SumCENT:uint32}],
            var Item=TR.To[i];
            WriteUint(Body,Item.ID);
            WriteUint(Body,Item.SumTER);
            WriteUint32(Body,Item.SumCENT);

            if(MapAccounts[Item.ID])
                MapAccounts[Item.ID].MustUpdate=MaxBlockNum+10;
        }

        WriteStr(Body,TR.Description);
        WriteUint(Body,TR.OperationID);


        var SignArr=GetArrFromHex(TR.Sign);
        for(var i=0;i<SignArr.length;i++)
        {
            Body[Body.length]=SignArr[i];
        }


        Body.length+=12;

        var SumPow = ParseNum(document.getElementById("idWalletPow").value);
        if(SumPow===0)
            SumPow=16;
        SendTransaction(Body,SumPow,TR,true);
    }



    //EXPLORER
    function ViewGrid(serverpath,nameid,bClear,bTotal)
    {
        GetData(serverpath, function (Data)
        {
            if(!Data || !Data.result)
                return;
            SetGridData(Data.arr,nameid,bTotal,bClear);
        });
    }

    function RetOpenBlock(Num,TrDataLen)
    {
        if(Num && TrDataLen)
            return '<INPUT type="button" onclick="ViewTransaction('+Num+')" class="" value="'+Num+'">';
        else
            return Num;
    }

    function ViewTransaction(BlockNum)
    {
        SetVisibleBlock("idTransactionBlock",1);
        document.getElementById("view_header_tr").innerText="Transactions on block: "+BlockNum;

        DefTr.Param3=BlockNum;
        ViewCurrent(DefTr);
    }




    //UTIL
    function RewriteTransactions()
    {
        var BlockNum=ParseNum(document.getElementById("idBlockNum").value);

        SetVisibleBlock("idServerBlock",1);
        SetStatus("Start rewrite transactions from: "+BlockNum);

        GetData("/RewriteTransactions",BlockNum, function (Data)
        {
            if(Data && Data.result)
            {
                SetStatus("Rewriting completed ");
            }
        });
    }
    function CheckBlocks()
    {
        var BlockNum=ParseNum(document.getElementById("idBlockNum").value);

        SetVisibleBlock("idServerBlock",1);
        SetStatus("Start CheckBlocks from: "+BlockNum);

        GetData("/CheckBlocks",BlockNum, function (Data)
        {
            if(Data && Data.result)
            {
                SetStatus("CheckBlocks completed");
            }
        });
    }

</script>


<script>

    //Pagination
    var CountViewRows=20;
    var DefAccounts={BlockName:"idPaginationAccount", NumName:"idViewAccountNum", TabName:"grid_accounts_all",APIName:"GetAccountsAll",Param3:"",TotalSum:1};
    var DefBlock={BlockName:"idPaginationBlock", NumName:"idViewBlockNum", TabName:"grid_block_all",APIName:"GetBlockAll",Param3:""};

    var DefTr={BlockName:"idTransactionBlock", NumName:"idViewTrNum", TabName:"grid_transaction_all",APIName:"GetTransactionAll",Param3:undefined};

    var DefHistory={BlockName:"idPaginationHistory", NumName:"idViewHistoryNum", TabName:"grid_history",APIName:"GetHistoryAct",Param3:""};
    var DefActs={BlockName:"idPaginationAct", NumName:"idViewActNum", TabName:"grid_acts_all",APIName:"GetActsAll",Param3:""};
    var DefHash={BlockName:"idPaginationHash", NumName:"idViewHashNum", TabName:"grid_hash_all",APIName:"GetHashAll",Param3:""};
    //History
    function ViewHistory()
    {
        ViewCurrent(DefHistory);
    }



    //Paginations lib
    function ViewCurrent(Def,flag)
    {
        if(flag)
        {
            SetVisibleBlock(Def.BlockName,!IsVisibleBlock(Def.BlockName));
        }
        else
        {
            SetVisibleBlock(Def.BlockName,true);
        }
        var item=document.getElementById(Def.NumName);
        ViewGrid("/"+Def.APIName+"/"+ParseNum(item.value)+"/"+CountViewRows+"/"+Def.Param3,Def.TabName,1,Def.TotalSum);
    }
    function ViewPrev(Def)
    {
        var item=document.getElementById(Def.NumName);
        var Num=ParseNum(item.value);
        Num-=CountViewRows;
        if(Num<0)
            Num=0;
        item.value=Num;

        ViewCurrent(Def);
    }
    function ViewNext(Def,MaxNum)
    {
        var item=document.getElementById(Def.NumName);
        var Num=ParseNum(item.value);
        Num+=CountViewRows;

        if(Num<MaxNum)
        {
            item.value=Num;
        }
        else
        {
            item.value=MaxNum-MaxNum%CountViewRows;
        }
        ViewCurrent(Def);
    }

    function DoStableScroll()
    {

        var scrollHeight = Math.max(
            document.body.scrollHeight, document.documentElement.scrollHeight,
            document.body.offsetHeight, document.documentElement.offsetHeight,
            document.body.clientHeight, document.documentElement.clientHeight
        );

        var item=document.getElementById("idStableScroll");
        var itemlHeight = Math.max(item.scrollHeight,item.offsetHeight,item.clientHeight);
        scrollHeight=scrollHeight-itemlHeight;

        //console.log("height="+itemlHeight );
        item.style.top=""+scrollHeight+"px";

    }
</script>

<style>
    #idStableScroll
    {
        z-index:0;
        position:absolute;
        top:100px;
        left:0px;
        height: 10px;
        color: darkred;
    }
</style>



<script>

    /*Get data from server Get data from server Get data from server Get data from server Get data from server */
    function UpdatesConfigData()
    {
        GetData("/GetWalletInfo", function (Data)
        {
            SetConfigData(Data);
        });
    }
    function UpdatesAccountsData()
    {
        GetData("/GetWalletAccounts", function (Data)
        {
            SetAccountsData(Data);
        });
    }

    function UpdatesData()
    {
        //UpdatesConfigData();
        UpdatesAccountsData();
        CheckNameAccTo();
        CheckSending();
    }



    function GetAccountText(Item,Num)
    {
        if(Item)
        {
            var text=Item.Description;
            if(!text || text.length===0)
                text=Num;
            else
                text=""+Num+". "+text;
            var StrSum=SUM_TO_STRING(Item.Value,true);
            text+=" ("+StrSum+")";

            return text;
        }
        else
        {
            return Num;
        }
    }
    function SetAccountsData(Data)
    {
        if(!Data || !Data.result)
            return;
        var arr=Data.ArrAcc;

        if(arr.length===0 && WasCreateAccountInfo!==PubKeyStr && WalletStatus==="OK")
        {
            WalletStatus="";

            SelectTab('TabAccounts');
            SetVisibleBlock("edit_create_acc",false);
            NewAccount();
        }

        //select list
        var Select=document.getElementById("idAccount");
        if(arr.length!==Select.options.length)
        {
            Select.options.length=arr.length;
        }

        SetGridData(arr,"grid_accounts");
        for(var i=0;arr && i<arr.length;i++)
        {
            var Item=arr[i];
            Item.MyAccount=true;

            var Num=ParseNum(Item.Num);
            if(!MapAccounts[Num])
                MapAccounts[Num]={};
            CopyObjKeys(MapAccounts[Num],Item);


            var option=Select.options[i];
            option.text=GetAccountText(Item,Num);
            option.value=Num;
        }

        var CurentValue=LoadMapAfter["idAccount"];
        if(CurentValue)
        {
            Select.value=CurentValue;
            delete LoadMapAfter["idAccount"];
        }
    }

    function SetConfigData(Data)
    {
        if(!Data || !Data.result)
            return;

        document.title="TERA 1."+Data.VersionNum;
        SetBlockChainConstant(Data);
        MaxBlockNum=GetCurrentBlockNumByTime();

        if(Data.RelayMode || !Data.CurBlockNum || !Data.BlockNumDB || Data.CurBlockNum>Data.BlockNumDB+BLOCK_PROCESSING_LENGTH*2)
        {
            CanSendTransaction=0;
            var StrMode="";
            var MaxNum=Data.CurBlockNum-BLOCK_PROCESSING_LENGTH;
            if(MaxNum>0)
            {
                var Percent=100*Data.BlockNumDB/MaxNum;
                if(Percent<0)
                    Percent=0;
                Percent=Percent.toPrecision(4);
                StrMode=" "+Percent+"% "+" ("+Data.BlockNumDB+"/"+MaxNum+")";
            }

            SetMainStatus("<DIV align='center' style='color:red'><big><B>Waiting for synchronization "+StrMode+"</B></big></DIV>");
            WalletStatus="WAIT";
        }
        else
        if(WalletStatus==="WAIT")
        {
            CanSendTransaction=1;
            WalletStatus="OK";
            SetMainStatus("<DIV align='center' style='color:green'><big><B>Synchronization complete</B></big></DIV>",1);
        }
        else
        {
            CanSendTransaction=1;
        }

        MiningAccount=Data.MiningAccount;
        MaxAccID=Data.MaxAccID;
        MaxActNum=Data.MaxActNum;
        //MaxBlockNum=Data.CurBlockNum;
//        if(MaxBlockNum!==Data.CurBlockNum)
//            SetStatus("Client num="+MaxBlockNum+"  server num="+Data.CurBlockNum)


        min_power_pow_acc_create=Data.MIN_POWER_POW_ACC_CREATE;
        PubKeyStr=Data.PublicKey;
        PrivKeyStr=Data.PrivateKey;
        WalletOpen=Data.WalletOpen;
        SetVisibleBlock("idOpenWallet",WalletOpen===false);
        SetVisibleBlock("wallet_config_tab",WalletOpen!==false);
        HistoryMaxNum=Data.HistoryMaxNum;



        SetArrLog(Data.ArrLog);

        if(document.getElementById("idPubKey").innerText!==PubKeyStr)
            document.getElementById("idPubKey").innerText=PubKeyStr;
        if(document.getElementById("idDataPath").innerText!==Data.DATA_PATH)
            document.getElementById("idDataPath").innerText=Data.DATA_PATH;
        if(document.getElementById("idNodeAddr").innerText!==Data.NodeAddrStr)
            document.getElementById("idNodeAddr").innerText=Data.NodeAddrStr;

        document.getElementById("idTo").max=MaxAccID;
        document.getElementById("idAdviser").max=MaxAccID;

        SetVisibleBlock("idDevelopService",Data.IsDevelopAccount);

        if(Data.NeedRestart)
        {
            SetStatus("<H1 align='center' style='color:blue'>Wallet updating complete. Please restart program.</H1>");
        }

        UpdateNetworkMode(Data);
    }

    function SetArrLog(arr)
    {
        var Str="";
        //for(var i=arr.length-1;i>=0;i--)
        for(var i=0;i<arr.length;i++)
        {
            var Item=arr[i];

            var tr_text=GetTransactionText(MapSendTransaction[Item.key],Item.key.substr(0,16));
            var info=Item.text;
            if(tr_text)
                info+=" ("+tr_text+")";

            if(Item.final)
            {
                var TR=MapSendTransaction[Item.key];
                if(TR && TR.AutoSetMining)
                {
                    var Select=document.getElementById("idAccount");
                    if(Select.options.length)
                    {
                        TR.AutoSetMining=0;
                        SaveMiningSet(Select.options[Select.options.length-1].value)
                    }
                }

                var Account=MapCheckTransaction[Item.key];
                if(Account)
                {
                    delete MapCheckTransaction[Item.key];
                    Account.NextSendTime=0;
                    //SetStatus("# "+info);
                }
            }

            Str=Str+info+"\n";
        }
        SetStatusFromServer(Str);
        CheckSending();
    }


    //NetworkParams
    //NetworkParams
    //NetworkParams

    function UpdateNetworkMode(Data)
    {
        if(Data.NET_WORK_MODE)
        {
            if(!Net_Work_Mode)
            {
                Net_Work_Mode=Data.NET_WORK_MODE;
                document.getElementById("idUseDirectIP").checked=Net_Work_Mode.UseDirectIP;
                if(Net_Work_Mode.ip)
                    document.getElementById("idIP").value=Net_Work_Mode.ip;
                if(Net_Work_Mode.port)
                    document.getElementById("idPort").value=Net_Work_Mode.port;
//                document.getElementById("idUseIncomeGrayIP").checked=Net_Work_Mode.UseIncomeGrayIP;
                if(Net_Work_Mode.NodeWhiteList)
                    document.getElementById("idNodeWhiteList").value=Net_Work_Mode.NodeWhiteList;
            }
            else
            {
                if(Data.NET_WORK_MODE.StunIP && !Net_Work_Mode.WasSets && !document.getElementById("idIP").value)
                {
                    if(Data.ip)
                        document.getElementById("idIP").value=Data.ip;
                    if(Data.port)
                        document.getElementById("idPort").value=Data.port;

                    if(Data.ip && Data.port)
                    {
                        Net_Work_Mode.WasSets=true;
                        document.getElementById("idUseDirectIP").checked=true;
                        if(Net_Work_Mode.ip===undefined)
                        {
                            SetNetworkParams(0);
                        }
                    }
                }
            }
        }
    }

    function SetNetworkParams(bRestart)
    {
        if(!Net_Work_Mode)
            Net_Work_Mode={};
        Net_Work_Mode.UseDirectIP=document.getElementById("idUseDirectIP").checked;
        Net_Work_Mode.ip=document.getElementById("idIP").value;
        Net_Work_Mode.port=ParseNum(document.getElementById("idPort").value);
        //Net_Work_Mode.UseIncomeGrayIP=document.getElementById("idUseIncomeGrayIP").checked;
        Net_Work_Mode.NodeWhiteList=document.getElementById("idNodeWhiteList").value;


        Net_Work_Mode.RestartNode=bRestart;

        GetData("/SetNetMode",Net_Work_Mode, function (Data)
        {
            SetStatus("Set net work params OK");
        });

    }

</script>



<script>


    //LIB
    function ConfirmationFromBlock(BlockNum)
    {
        var Length=MaxBlockNum-8-BlockNum;
        if(Length>0)
        {
            if(Length<=100)
                return Length;
            else
            {
                return ">"+Math.floor(Length/100)*100;
            }
        }
        else
            return "";
    }
    function DateFromBlock(BlockNum)
    {
        var Str;
        if(window.FIRST_TIME_BLOCK)
        {
            var now=new Date(window.FIRST_TIME_BLOCK+BlockNum*1000);
            Str=now.toISOString();
            Str=Str.substr(0,Str.indexOf("."));
            Str=Str.replace("T"," ");
        }
        else
            Str="";
        return Str;
    }



    var glWorkNum=0;
    function SetGridData(arr,id_name,btotal,bclear,revert)
    {
        var htmlTable=document.getElementById(id_name);

        if(bclear)
            ClearTable(htmlTable);


        if(!htmlTable.ItemsMap)
            htmlTable.ItemsMap={};

        var map=htmlTable.ItemsMap;

        glWorkNum++;
        var ValueTotal={SumTER:0,SumCENT:0};


        var row0=htmlTable.rows[0];
        var colcount=row0.cells.length;
        for(var i=0;arr && i<arr.length;i++)
        {
            var Item=arr[i];
            var ID=(Item.Num);

            var row=map[ID];
            if(!row)
            {
                htmlTable.RowCount++;
                if(revert)
                    row=htmlTable.insertRow(1);
                else
                    row=htmlTable.insertRow(-1);
                map[ID]=row;
                for(var n=0;n<colcount;n++)
                {
                    var cell0=row0.cells[n];
                    var cell=row.insertCell(n);
                    cell.className  = cell0.className;
                }
            }
            row.Work=glWorkNum;
            for(var n=0;n<colcount;n++)
            {
                var cell0=row0.cells[n];
                var cell=row.cells[n];
                var formula=cell0.id;
                if(formula.substr(0,1)==="(")
                {
                    var text=eval(formula);
                    if(cell.innerHTML!==text)
                        cell.innerHTML=text;
                }
                else
                {
                    var text=eval(formula);
                    if(cell.innerText!==text)
                        cell.innerText=text;
                }
            }

            if(btotal)
                ADD(ValueTotal,Item.Value);
        }

        //delete old
        for(var key in map)
        {
            var row=map[key];
            if(row.Work!==glWorkNum)
            {
                htmlTable.deleteRow(row.rowIndex);
                delete map[key];
            }
        }
        if(btotal)
        {
            var id = document.getElementById("idTotalSum");
            id.innerText="Total: "+SUM_TO_STRING(ValueTotal,1);

        }

        DoStableScroll();
    }

    function ClearTable(htmlTable)
    {
        for(var i=htmlTable.rows.length-1;i>0;i--)
            htmlTable.deleteRow(i);
        htmlTable.ItemsMap={};
        htmlTable.RowCount=0;
    }
    function FormatingCode(Str)
    {
        Str=escapeHtml(Str);
        return Str;
    }

    var entityMap =
        {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': '&quot;',
            "'": '&#39;',
            "/": '&#x2F;',
            "\n": '<BR>',
            " ": '&nbsp',
    };
    function escapeHtml(string)
    {
        return String(string).replace(/[\s\n&<>"'\/]/g, function (s)
        {
            return entityMap[s];
        });
    }


    function ToLogServer(Str)
    {
        GetData("/ToLogServer",Str, function (Data)
        {
            UpdatesData();
        });

    }
    function SetStatusFromServer(Str)
    {
        var id = document.getElementById("idServerLog");
        if(id.innerText!==Str)
            id.innerText=Str;
    }

    var bMainCanClear=true;
    var StrMainStatus="";
    var StrNormalStatus="";
    function SetMainStatus(Str,bCanClear)
    {
        bMainCanClear=bCanClear;
        StrMainStatus=Str;
        ViewStatus();
    }
    function SetStatus(Str)
    {
        StrNormalStatus=Str;
        if(bMainCanClear)
        {
            StrMainStatus="";
        }
        ViewStatus();
    }

    function ViewStatus()
    {
        var Str=StrMainStatus+StrNormalStatus;
        var id = document.getElementById("idStatus");
        id.innerHTML=Str;
    }
    function SetError(Str)
    {
        SetStatus("<DIV  align='left' style='color:red'><B>"+Str+"</B></DIV>");
    }


    //TRANSACTON
    var glTrSendNum=0;
    function SendTransaction(Body,SumPow,TR,BlockSend)
    {
        glTrSendNum++;
        SetStatus("Prepare to sending...");


        CreateNonceAndSend(1,0,BlockSend);
        function CreateNonceAndSend(bCreateNonce,startnonce,BlockSend)
        {
            var CurTrNum=glTrSendNum;
            var nonce=startnonce;
            if(bCreateNonce)
                nonce=CreateHashBodyPOWInnerMinPower(Body,SumPow)

            var StrHex=GetHexFromArr(Body);

            GetData("/SendTransactionHex/"+StrHex, function (Data)
            {
                if(Data)
                {
                    var BlockNum=GetCurrentBlockNumByTime();
                    var key=GetHexFromArr(shaarr(Body));
                    SetStatus("Send TR:'"+key.substr(0,12)+"' to block: "+BlockNum+" result:"+Data.text);

                    if(Data.text==="Not add")
                    {
                        CreateNonceAndSend(1,nonce+1,BlockSend);
                    }
                    else
                    if(Data.text==="Bad time")
                    {
                        SetStatus("Next send TR:'"+key.substr(0,12)+"'...");
                        setTimeout(function ()
                        {
                            if(CurTrNum===glTrSendNum)
                                CreateNonceAndSend(0,nonce,BlockSend);
                        },100);
                    }
                    else
                    {
                        var key=GetHexFromArr(shaarr(Body));
                        MapSendTransaction[key]=TR;

                        if(BlockSend)
                        {
                            var FromID = ParseNum(document.getElementById("idAccount").value);
                            var Item=MapAccounts[FromID];
                            if(Item)
                            {
                                Item.LastTransactionText=GetTransactionText(TR);
                                Item.NextSendTime=BlockNum+10;

                                MapCheckTransaction[key]=Item;
                                CheckSending();
                                //Item.CheckTransaction=GetHexFromArr(shaarr(Body));
                                //SetStatus("Block TR: "+Item.CheckTransaction);
                            }
                        }
                    }
                }
            });
        }
    }


    //EVENTS
    //EVENTS
    //EVENTS
    function SetVisibleTab()
    {
        if(!CurTabName)
            CurTabName=TabArr[0].name;

        var bLogVisible=0;
        var str;
        for (var i=0;i<TabArr.length;i++)
        {
            var name=TabArr[i].name;
            var Item=document.getElementById(name);
            if(!Item)
                continue;
            if(CurTabName===name)
            {
                bLogVisible=TabArr[i].log;
                Item.style.display = 'block';
                str="current bt bttab"
            }
            else
            {
                Item.style.display = 'none';
                str="bttab bt"
            }

            var ItemM=document.getElementById("M"+name);
            if(ItemM)
                ItemM.className=str;
        }



        //SetVisibleBlock("idStatus",bLogVisible);
        SetVisibleBlock("idServerBlock",bLogVisible);

    }

    function SelectTab(name)
    {
        CurTabName=name;

        if(CurTabName==="TabHistory")
        {
            ViewHistory();
        }

        SetVisibleTab();
    }

    function CheckCtrlEnterAndESC(e,F)
    {
        SaveValues();

        if(e.ctrlKey && e.keyCode===13)
        {

            if(CurTabName==="TabAccounts" && IsVisibleBlock("edit_keys"))
                SavePrivateKey();
            else
            if(CurTabName==="TabAccounts" && IsVisibleBlock("edit_create_acc"))
                CreateAccount();
            else
            if(CurTabName==="TabAccounts" && IsVisibleBlock("edit_mining_set"))
                SaveMiningSet();
            else
            if(CurTabName==="TabSend")
            {
                if(IsVisibleBlock("edit_transaction"))
                    SignAndSendFromJSON();
                else
                    SendMoney();

            }
            else
            if(IsVisibleBlock("idBlockPassword"))
                SetPassword();
            else
                if(WalletOpen===false)
                {
                    ViewOpenWallet();
                }


        }
        else
        if(e.keyCode===27)
        {

            if(CurTabName==="TabAccounts" && IsVisibleBlock("edit_keys"))
                CancelSavePrivateKey();
            else
            if(CurTabName==="TabAccounts" && IsVisibleBlock("edit_create_acc"))
                CancelCreateAccount();
            else
            if(CurTabName==="TabAccounts" && IsVisibleBlock("edit_mining_set"))
                CancalMiningSet();
            else
            if(CurTabName==="TabSend" && IsVisibleBlock("edit_transaction"))
                SetVisibleBlock("edit_transaction",false)
            else
            if(IsVisibleBlock("idBlockPassword"))
                CancelSetPassword();

        }

    }

    function LoadValues()
    {
        if(localStorage["VerSave"]!=="2")
            return;
        CurTabName=localStorage["CurTabName"];
        for(var i=0;i<SaveIdArr.length;i++)
        {
            var name=SaveIdArr[i];
            var Item=document.getElementById(name);

            if(Item.nodeName==="SELECT")
            {
                LoadMapAfter[name]=localStorage.getItem(name);
            }
//            else
//            {
//                Item.value=localStorage.getItem(name);
//            }
            Item.value=localStorage.getItem(name);
            //Item.checked
        }
    }
    function SaveValues()
    {
        localStorage["VerSave"]="2";
        localStorage["CurTabName"]=CurTabName;
        for(var i=0;i<SaveIdArr.length;i++)
        {
            var name=SaveIdArr[i];
            var Item=document.getElementById(name);
            window.localStorage.setItem(name,Item.value);
            //Item.checked
        }
    }

    //INIT
    //INIT
    //INIT
    function SelectStyle(value)
    {
        var Select=document.getElementById("idSelStyle");
        if(value)
            Select.value=value;

        if(!Select.value)
            Select.value=Select.options[0].value;
        document.body.className=Select.value;
    }
    window.onload=function()
    {
        InitPasItems();

        UpdatesConfigData();
        UpdatesData();

        setInterval(UpdatesData,1000);
        setInterval(UpdatesConfigData,200);

        LoadValues();
        SelectStyle();
        SelectTypeKey();

        window.onkeydown = CheckCtrlEnterAndESC;
        setInterval(SaveValues,2000);


        SetVisibleTab();
        setTimeout(CheckNameAccTo,100);

        if(CurTabName==="TabHistory")
            setTimeout(function ()
            {
                ViewHistory();
            },500)



    }


</script>

<script>
    function CreateCheckPoint()
    {
        GetData("/SetCheckPoint/",function (Data)
        {
            if(Data && Data.result===1)
            {
                SetStatus(Data.text);
            }
        });
    }
    function SetNewCodeVersion()
    {
        var VersionNum=document.getElementById("idVersionNum").value;
        GetData("/SetNewCodeVersion/"+VersionNum,function (Data)
        {
            if(Data && Data.result===1)
            {
                SetStatus(Data.text);
            }
        });
    }
    function TruncateBlockChain()
    {
        var VersionNum=document.getElementById("idTruncateBlockNum").value;
        GetData("/TruncateBlockChain/"+VersionNum,function (Data)
        {
            if(Data && Data.result===1)
            {
                SetStatus(Data.text);
            }
        });
     }

    function OnRestartNode()
    {
        GetData("/RestartNode");

    }


</script>

<script>
    var itemPassword1,itemPassword2;
    function InitPasItems()
    {
        itemPassword1=document.getElementById("idPassword1");
        itemPassword2=document.getElementById("idPassword2");
    }

    function ViewOpenWallet()
    {
        if(WalletOpen!==false)
        {
            SetStatus("Wallet not close");
            return;
        }

        itemPassword1.onkeydown = OnEnterPas1;
        itemPassword1.value="";
        SetVisibleBlock("idBlockPassword",true);
        SetVisibleBlock("idPasswordRow2","none");
        itemPassword1.focus();
    }
    function OpenWallet()
    {
        var Passwd1=itemPassword1.value;
        GetData("/OpenWallet/",Passwd1, function (Data)
        {
            if(Data && Data.result===1)
            {
                SetStatus("Wallet open");
                SetVisibleBlock("idBlockPassword",false);
            }
            else
            {
                SetError("Wrong password!")
            }
        });

    }
    function CancelOpenWallet()
    {
        SetVisibleBlock("idBlockPassword",false);
    }


    function ViewSetPassword()
    {
        if(WalletOpen===false)
        {
            SetError("First open wallet!");
            return;
        }

        itemPassword1.onkeydown = OnEnterPas1;
        itemPassword2.onkeydown = OnEnterPas2;

        itemPassword1.value="";
        itemPassword2.value="";
        SetVisibleBlock("idBlockPassword",!IsVisibleBlock("idBlockPassword"));
        SetVisibleBlock("idPasswordRow2","table-row");
        itemPassword1.focus();
    }


    function SetPassword()
    {
        if(!IsVisibleBlock("idPasswordRow2"))
        {
            OpenWallet();
            return;
        }

        var Passwd1=itemPassword1.value;
        var Passwd2=itemPassword2.value;
        if(Passwd1!==Passwd2)
        {
            SetError("Passwords are not equal");
            return;
        }

        GetData("/SetWalletPasswordNew/",Passwd1, function (Data)
        {
            if(Data && Data.result===1)
            {
                SetStatus("New password was set");
                SetVisibleBlock("idBlockPassword",false);
            }
        });
    }
    function CancelSetPassword()
    {
        SetVisibleBlock("idBlockPassword",false);
    }

    function OnEnterPas1(e)
    {
        if(e.keyCode===13)
        {
            if(IsVisibleBlock("idPasswordRow2"))
            {
                itemPassword2.focus();
            }
            else
            {
                OpenWallet();
            }
        }
        //SetStatus("e.keyCode="+e.keyCode)
    }
    function OnEnterPas2(e)
    {
        if(e.keyCode===13)
        {
            SetPassword();
        }
        //SetStatus("e.keyCode="+e.keyCode)
    }

</script>

<style type="text/css">

    table.password
    {
        border-collapse: collapse;
        width: 400px;
    }

    #idOpenWallet
    {
        z-index:1001;
        position:absolute;
        top:42px;
        left:660px;
        padding: 0 0 0 20px;
        text-align: center;
        box-shadow: 0 0 0 1px;

        width: 130px;
        height: 40px;
        line-height: 20px;
        margin: 10px;
        background: transparent;
        font-weight: 600;

        background-image: url('/HTML/PIC/key.png');
        background-repeat: no-repeat;
        background-size: 20%;
        cursor: pointer;

    }
    #idBlockPassword
    {
        z-index:1000;
        position:fixed;
        top:200px;
        left:250px;
        height:150px;
        width:320px;
        padding: 10px;
        background: #d9d9d9;
        text-align: left;
        box-shadow: 0 0 0 1px;

        background-image: url('/HTML/PIC/key.png');
        background-repeat: no-repeat;
        background-size: 10%;

    }

</style>



<body>


<table id="TabHeader" onclick="SelectTab">
    <tr>
        <th><INPUT id="MTabAccounts" type="button" onclick="SelectTab('TabAccounts')" class="bttab" value="CONFIG"></th>
        <th><INPUT id="MTabSend" type="button" onclick="SelectTab('TabSend')" class="bttab" value="SEND"></th>
        <th><INPUT id="MTabHistory" type="button" onclick="SelectTab('TabHistory')" class="bttab" value="HISTORY"></th>
        <th><INPUT id="MTabExplorer" type="button" onclick="SelectTab('TabExplorer')" class="bttab" value="EXPLORER"></th>
    </tr>
</table>

<INPUT id="idOpenWallet" style="display: none" type="button" onclick="ViewOpenWallet()" value="Open Wallet">

<DIV id="idStatus">&nbsp;</DIV>
<BR><BR><BR>

<DIV id="TabAccounts" style="display: block">
    <BR>
    Wallet data path: <B id="idDataPath"></B><BR>
    Public key: <B id="idPubKey"></B><BR>
    Node addr: <B id="idNodeAddr"></B>

    <DIV id="wallet_config_tab" style="display: none">
        <INPUT type="button" onclick="NewAccount()" class="btdoit bt" value="New account" id="idDown">
        <INPUT type="button" onclick="EditPrivateKey()" class="btdoit bt" value="Edit Key" id="idDown">
        <INPUT type="button" onclick="NewPrivateKey()" class="btdoit bt" value="New Key..." id="idDown2">
        <INPUT type="button" onclick="MiningSets()" class="btdoit bt" value="Mining Sets" id="idDown">
        <INPUT type="button" onclick="ViewSetPassword()" class="bt btdoit" value="Set Password" id="idDown">
    </DIV>


    <DIV id="edit_mining_set" style="display: none">
        <table class="form_input keys" id="grid_mining_set">
            <tr>
                <td><DIV>Mining account:</DIV></td><td><INPUT type="number" id="idMiningAccount" min=0 max=1000000000000 value="0"></td>
            </tr>

            <tr>
                <td></td>
                <td><INPUT type="button" onclick="SaveMiningSet()" class="bt" value="Save">
                    <INPUT type="button" onclick="CancalMiningSet()" class="bt" value="Cancel"></td>
            </tr>
        </table>
    </DIV>


    <DIV id="edit_keys" style="display: none">
        <table class="form_input keys" id="grid_edit_key">
            <tr>
                <td>
                    <select size="1" id="idTypeKey" onkeyup="SelectTypeKey();SaveValues()" onchange="SelectTypeKey();SaveValues()">
                        <option value="private">Private key</option>
                        <option value="public">Public key (sign from another wallet)</option>
                    </select>
                </td><td><INPUT type="string" id="idKeyNew" value=""></td>
            </tr>
            <tr>
                <td></td>
                <td><INPUT type="button" onclick="SavePrivateKey()" class="bt" value="Save">
                    <INPUT type="button" onclick="CancelSavePrivateKey()" class="bt" value="Cancel">
                </td>

            </tr>
        </table>
    </DIV>




    <DIV id="edit_create_acc" style="display: none">
        <table class="form_input keys" id="grid_edit_newacc">
            <tr>
                <td><DIV>Short public name:</DIV></td><td><INPUT type="string" maxlength="40" id="idAccDescription" onkeyup="CheckLengthAccDesription('idAccDescription',40)" value=""></td>
            </tr>

            <tr>
                <td><DIV>Adviser:</DIV></td><td><INPUT type="number" id="idAdviser" min=0 max=1000000000000 value="0"></td>
            </tr>
            <tr>
                <td></td><td><INPUT type="checkbox" checked id="idAutoSetMining">Mining on this account</td>
            </tr>

            <tr>
                <td></td>
                <td><INPUT type="button" onclick="CreateAccount()" class="bt" value="Create">
                    <INPUT type="button" onclick="CancelCreateAccount()" class="bt" value="Cancel"></td>
            </tr>

        </table>
    </DIV>


    <BR>
    <table id="grid_accounts" class="grid">
        <tr>
            <th id="Item.Num" class="num">ID</th>
            <th id="SUM_TO_STRING(Item.Value)" class="sum">Amount</th>
            <th id="MapCurrency[Item.Currency]" class="cur">Currency</th>
            <th id="Item.Description" class="name">Account name</th>
            <th id="Item.Value.OperationID" class="num">Operation</th>
            <th id="Item.RefID" class="num">Adviser</th>

        </tr>
    </table>

    <HR>
    Network connections:<BR>
    <INPUT type="checkbox" id="idUseDirectIP">Run server and use direct IPv4 address on this computer (recommended):<BR>
    IP:<INPUT  maxlength="16" id="idIP"> Port:<INPUT maxlength="9" id="idPort"><BR>
    <!--<INPUT type="checkbox" id="idUseIncomeGrayIP">Allow connection users without a direct ip:<BR>-->
    White list nodes (HEX-format):<BR>
    <TEXTAREA id="idNodeWhiteList" rows="4" cols="110"> </TEXTAREA>
    <BR>

    <INPUT type="button" onclick="SetNetworkParams(0)" class="btdoit bt" value="Save">
    <INPUT type="button" onclick="SetNetworkParams(1)" class="btdoit bt" value="Save and Restart">

    <DIV id="idDevelopService" style="display: none">
        <HR>
        <INPUT type="button" id="idOpenService" onclick="SetVisibleBlock('idDevelopServiceView',!IsVisibleBlock('idDevelopServiceView'))" class="btdoit bt" value="Developer service">
        <DIV id="idDevelopServiceView" style="display: none">
            <H3>Developer service:</H3>

            <INPUT type="button" onclick="CreateCheckPoint()" class="btdoit btlong bt" value="Create check point">
            <INPUT type="button" onclick="SetNewCodeVersion()" class="btdoit btlong bt" value="Set new code version:">
            <INPUT type="string" id="idVersionNum" maxlength="6" value="1">

            <BR>
            <INPUT type="button" onclick="TruncateBlockChain()" class="btdoit btlong bt" value="Truncate chain:">
            <INPUT type="string" id="idTruncateBlockNum" maxlength="6" value="0">
            <BR>
        </DIV>
    </DIV>

    <BR>
    Style:
    <select size="1" id="idSelStyle" onkeyup="SelectStyle();SaveValues()" onchange="SelectStyle();SaveValues()">
        <option value="styleBrown">Brown</option>
        <option value="styleBlue">Blue</option>
        <option value="styleGreen">Green</option>
    </select>


</DIV>


<DIV id="TabHistory" style="display: none">
    <DIV id="idPaginationHistory" style="display: none">
        <INPUT type="button" onclick="ViewPrev(DefHistory)" class="btdoit bt" value="<< Prev">
        <INPUT type="number" id="idViewHistoryNum" style="text-align: center" value="0" min=0 max=1000000000 onchange="ViewCurrent(DefHistory)">
        <INPUT type="button" onclick="ViewNext(DefHistory,HistoryMaxNum)" class="btdoit bt" value="Next >>">
    </DIV>

    <table id="grid_history" class="grid">
        <tr>
            <th id="Item.Direct">Direct</th>
            <th id="ConfirmationFromBlock(Item.BlockNum)" class="txt">Confirm</th>
            <th id="DateFromBlock(Item.BlockNum)" class="date">Date</th>
            <th id="SUM_TO_STRING(Item)" class="sum">Amount</th>
            <th id="MapCurrency[Item.Currency]" class="cur">Currency</th>
            <th id="Item.Description"class="desc">Description</th>
            <th id="Item.FromID" class="num">From</th>
            <th id="GetStrID(Item.ToID)" class="num">To</th>
            <th id="''+Item.FromID+'/'+Item.FromOperationID">Reference</th>
            <th id="Item.BlockNum" class="num">Block</th>
        </tr>

    </table>
</DIV>



<DIV id="TabSend" style="display: none">

    <table class="form_input">
        <tr>
            <td>From account</td>
            <td>

                <select size="1" id="idAccount" onkeyup="OnEditTransactionFields()" onchange="OnEditTransactionFields()">
                </select>

            </td>
        </tr>
        <tr><td>&nbsp;</td><td><DIV id="idNameTo" class="bold"></DIV></td></tr>
        <tr>
            <td>Pay to</td><td><INPUT style="float: left" type="number" id="idTo" min=1 max=1000000000000 value="" onkeyup="OnEditIdTo()" onchange="OnEditIdTo()"
                                      placeholder="Payee (required)" ></td>
        </tr>
        <tr>
            <td>Amount</td>
            <td>
                <DIV class="short_input">
                    <INPUT type="number" id="idSumTER" value="" min=0 max=1000000000 onkeyup="OnEditTransactionFields()" onchange="OnEditTransactionFields()"><B>.</B>
                    <INPUT type="number" id="idSumCENT" value="" min=0 max=999999999 onkeyup="OnEditTransactionFields()" onchange="OnEditTransactionFields()"> <B>TER</B>
                </DIV>
            </td>
        </tr>
        <tr>
            <td>Description (optional)</td><td><textarea id="idDescription" rows="4" onkeyup="CheckLengthAccDesription('idDescription',200);OnEditTransactionFields()" onchange="OnEditTransactionFields()"></textarea></td>
        </tr>
        <tr>
            <td>
            </td>
            <td>
                <INPUT type="button" onclick="ClearTransaction()" class="bsend bt" value="Clear">
                <INPUT type="button" onclick="EditJSONTransaction()" class="bsend bt" value="Edit JSON" id="idDown">
                <INPUT type="button" onclick="SendMoney()" class="bsend bt" id="idSendButton" value="Send" >
            </td>
        </tr>
    </table>
    <DIV id="edit_transaction" style="display: none">
        <textarea id="idTransaction" rows="18" onkeyup="StartEditTransactionJSON()" onchange="StartEditTransactionJSON()"></textarea>
        <BR>
        <INPUT type="button" onclick="SignJSON()" class="btdoit bt" value="Sign JSON" id="idSignJSON">
        <INPUT type="button" onclick="SendMoneyJSON()" class="btdoit bt" value="Send from JSON">
        POW:<INPUT type="number" id="idWalletPow" value="15">
    </DIV>



</DIV>




<DIV id="TabExplorer" style="display: none">

    <INPUT type="button" onclick="window.Open('./HTML/stat.html','counters')" class="btdoit btmedium bt" id="idCounters" value="Counters">
    <INPUT type="button" onclick="window.Open('./HTML/chains.html','chains',1030)" class="btdoit btmedium bt" id="idChains" value="Chains">
    <INPUT type="button" onclick="window.Open('./HTML/monitor.html','monitor',1200)" class="btdoit btmedium bt" id="idMonitor" value="Monitor">
    <INPUT type="button" onclick="window.Open('./HTML/console.html','console')" class="btdoit btmedium bt" id="idConsole" value="Console">

    <BR>
    <INPUT type="button" onclick="ViewCurrent(DefAccounts,1)" class="btdoit bt" id="idViewAccounts" value="Accounts">
    <INPUT type="button" onclick="ViewCurrent(DefBlock,1)" class="btdoit bt" id="idViewBlock" value="Blocks & Tr">
    <INPUT type="button" onclick="ViewCurrent(DefActs,1)" class="btdoit bt" id="idViewActs" value="Accounts acts">
    <INPUT type="button" onclick="ViewCurrent(DefHash,1)" class="btdoit bt" id="idViewHash" value="Accounts hash">
    <INPUT type="button" onclick="SetVisibleBlock('idUtilView',!IsVisibleBlock('idUtilView'))" class="btdoit bt" id="idViewUtil" value="Utilites">
    <BR>

    <BR>
    <DIV id="idPaginationAccount" style="display: none">
        <HR>
        <DIV id="view_header" >Accounts</DIV><BR>
        <INPUT type="button" onclick="ViewPrev(DefAccounts)" class="btdoit bt" value="<< Prev">
        <INPUT type="number" id="idViewAccountNum" style="text-align: center" value="0" min=0 max=1000000000 onchange="ViewCurrent(DefAccounts)">
        <INPUT type="button" onclick="ViewNext(DefAccounts,MaxAccID)" class="btdoit bt" value="Next >>">

        <table id="grid_accounts_all" class="grid">
            <tr>
                <th id="Item.Num" class="num">ID</th>
                <th id="SUM_TO_STRING(Item.Value)" class="sum">Amount</th>
                <th id="MapCurrency[Item.Currency]" class="cur">Currency</th>
                <th id="Item.Description" class="name">Account name</th>
                <th id="Item.PubKey.substr(0,66)" class="code">PubKey</th>
                <th id="Item.Value.OperationID" class="num">Operation</th>
                <th id="Item.BlockNumCreate" class="num">Block Num</th>
            </tr>
        </table>
    <BR>
    <B><DIV id="idTotalSum"></DIV></B>
    <BR>
    </DIV>

    <DIV id="idPaginationBlock" style="display: none">
        <HR>
        <DIV id="view_header" >Blocks<BR></DIV>
        <INPUT type="button" onclick="ViewPrev(DefBlock)" class="btdoit bt" value="<< Prev">
        <INPUT type="number" id="idViewBlockNum" style="text-align: center" value="0" min=0 max=1000000000 onchange="ViewCurrent(DefBlock)">
        <INPUT type="button" onclick="ViewNext(DefBlock,MaxBlockNum-8)" class="btdoit bt" value="Next >>">

        <table id="grid_block_all" class="grid">
            <tr>
                <th id="(RetOpenBlock(Item.BlockNum,Item.TrDataLen))" class="num">Open</th>
                <th id="Item.TrDataLen" class="num">Bytes</th>

                <th id="GetHexFromArr(Item.Hash)" class="code">Hash</th>
                <th id="Item.Power" class="num">Pow</th>
                <th id="Item.Miner" class="num">Miner</th>

            </tr>
        </table>



        <DIV id="idTransactionBlock" style="display: none">
            <BR>
            <DIV id="view_header_tr" >Transactions on block<BR></DIV>
            <INPUT type="button" onclick="ViewPrev(DefTr)" class="btdoit bt" value="<< Prev">
            <INPUT type="number" id="idViewTrNum" style="text-align: center" value="0" min=0 max=1000000000 onchange="ViewCurrent(DefTr)">
            <INPUT type="button" onclick="ViewNext(DefTr,5000)" class="btdoit bt" value="Next >>">

            <table id="grid_transaction_all" class="grid">
                <tr>
                    <th id="Item.Num" class="num">Num</th>
                    <th id="Item.Type" class="num">Type</th>
                    <th id="GetHexFromArr(Item.Body)" class="code">Body</th>
                    <th id="(FormatingCode(Item.Script))" class="code">JSON</th>
                    <th id="GetHexFromArr(Item.HASH)" class="code">HASH</th>
                    <th id="Item.power" class="num">power</th>
                </tr>
            </table>
        </DIV>

    </DIV>


    <DIV id="idPaginationAct" style="display: none">

        <DIV id="view_header" >Accounts acts<BR></DIV>
        <INPUT type="button" onclick="ViewPrev(DefActs)" class="btdoit bt" value="<< Prev">
        <INPUT type="number" id="idViewActNum" style="text-align: center" value="0" min=0 max=1000000000 onchange="ViewCurrent(DefActs)">
        <INPUT type="button" onclick="ViewNext(DefActs,MaxActNum)" class="btdoit bt" value="Next >>">


        <table id="grid_acts_all" class="grid">
            <tr>
                <th id="Item.Num" class="num">Num</th>
                <th id="Item.ID" class="num">Account</th>
                <th id="Item.Mode">Mode</th>
                <th id="Item.BlockNum" class="num">Block</th>

                <th id="Item.PrevValue.OperationID" class="num">Prev. Operation</th>
                <th id="Item.PrevValue.BlockNum" class="num">Prev. Block</th>
                <th id="SUM_TO_STRING(Item.PrevValue)" class="sum">Prev. amount</th>
            </tr>
        </table>
    </DIV>

    <DIV id="idPaginationHash" style="display: none">
        <HR>
        <DIV id="view_header" >Accounts hash<BR></DIV>
        <INPUT type="button" onclick="ViewPrev(DefHash)" class="btdoit bt" value="<< Prev">
        <INPUT type="number" id="idViewHashNum" style="text-align: center" value="0" min=0 max=1000000000 onchange="ViewCurrent(DefHash)">
        <INPUT type="button" onclick="ViewNext(DefHash,MaxBlockNum-8)" class="btdoit bt" value="Next >>">

        <table id="grid_hash_all" class="grid">
            <tr>
                <th id="Item.BlockNum" class="num">Block</th>
                <th id="GetHexFromArr(Item.Hash)" class="code">Hash</th>
            </tr>
        </table>
    </DIV>

    <DIV id="idUtilView" style="display: none">
        <HR>
        <DIV id="view_header" >UTILITES<BR></DIV>

        Block num:<INPUT type="number" id="idBlockNum" value="0">
        <INPUT type="button" onclick="RewriteTransactions()"  class="bt btdoit btlong" value="Rewrite Transactions">
        <INPUT type="button" onclick="CheckBlocks()"  class="bt btdoit btlong" value="Check Blocks">
        <BR>

    </DIV>
</DIV>



<BR>
<DIV id="idServerBlock">
    <HR>
    Core log (from inner server):
    <DIV id="idServerLog"></DIV><BR>
</DIV>




<DIV id="idBlockPassword" style="display: none">
    <H3 align="center">Enter your password:</H3>
    <table class="password" id="idTablePassword">
        <tr>
            <td><DIV>Password:</DIV></td><td><INPUT type="password"  id="idPassword1" value=""></td>
        </tr>

        <tr id="idPasswordRow2" style="display: none">
            <td><DIV>Repeat:</DIV></td><td><INPUT type="password"  id="idPassword2" onkeyup="" value=""></td>
        </tr>

        <tr>
            <td></td>
            <td><INPUT type="button" onclick="SetPassword()" class="bt" value="Set">
                <INPUT type="button" onclick="CancelSetPassword()" class="bt" value="Cancel"></td>
        </tr>

    </table>
</DIV>

<DIV id="idStableScroll">
    @terafoundation
    <!--progr76@gmail.com-->
</DIV>

</body>


</html>